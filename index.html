<!DOCTYPE html>
<html lang="en">
<head>
  <style>
  #xrpChange[data-dir="up"],
  #soloChange[data-dir="up"],
  #jcsChange[data-dir="up"] {
    color: #0a8f55;
  }
  #xrpChange[data-dir="down"],
  #soloChange[data-dir="down"],
  #jcsChange[data-dir="down"] {
    color: #c62828;
  }
</style>

  <!-- Basic SEO -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Jesus Christ Token (JCS) on the XRP Ledger | Faith-Based Cryptocurrency</title>
  <meta name="description" content="Jesus Christ Token (JCS) is a faith-based cryptocurrency on the XRP Ledger focused on transparent giving, stewardship, and global outreach." />
  <meta name="keywords" content="Jesus Christ Token, JCS, XRP Ledger, XRPL, faith-based crypto, transparent giving, Christian crypto, blockchain stewardship" />
  <meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" />
  <meta name="theme-color" content="#0e1b3d" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />

  <!-- Canonical + Social (COMMENTED until you set your URL) -->
 <div>
  <strong>XRP:</strong> <span id="xrpPrice">—</span> <small id="xrpChange" data-dir="">—</small>
</div>
<div>
  <strong>SOLO:</strong> <span id="soloPrice">—</span> <small id="soloChange" data-dir="">—</small>
</div>
<div>
  <strong>JCS:</strong> <span id="jcsPrice">—</span> <small id="jcsChange" data-dir="">—</small>
</div>
<div>
  <strong>JCS Market Cap:</strong> <span id="jcsMcap">—</span>
</div>
 <!--
  <link rel="canonical" href="https://YOUR-DOMAIN/" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Jesus Christ Token (JCS) on the XRP Ledger" />
  <meta property="og:description" content="Transparent giving and digital stewardship powered by the XRP Ledger." />
  <meta property="og:url" content="https://YOUR-DOMAIN/" />
  <meta property="og:image" content="https://YOUR-DOMAIN/assets/img/og-image.jpg" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Jesus Christ Token (JCS) on XRPL" />
  <meta name="twitter:description" content="Where faith meets innovation—transparent giving on XRPL." />
  <meta name="twitter:image" content="https://YOUR-DOMAIN/assets/img/og-image.jpg" />
  -->

  <!-- JSON-LD Structured Data (Project + Organization) -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Project",
    "name": "Jesus Christ Token (JCS)",
    "alternateName": "JCS",
    "description": "A faith-based cryptocurrency project on the XRP Ledger focused on transparent giving, stewardship, and global outreach.",
    "keywords": "Jesus Christ Token, JCS, XRPL, XRP Ledger, Christian crypto, transparent giving, blockchain stewardship",
    "creator": {
      "@type": "Organization",
      "name": "Jesus Christ Saves Ministry",
      "url": "https://example.com", 
      "logo": "https://example.com/assets/img/logo.png",
      "sameAs": []
    },
    "url": "https://example.com",
    "image": "https://example.com/assets/img/og-image.jpg"
  }
  </script>

  <!-- Base styles: responsive, even spacing, no overlap -->
  <style>
    :root{
      --bg:#0a132b;
      --bg-soft:#0f1f4a;
      --card:#111c3f;
      --text:#f2f5ff;
      --muted:#b7c3ff;
      --accent:#00e1ff;
      --good:#2bd173;
      --bad:#ff5e76;
      --gold:#ffd166;
      --maxw:1150px;
      --radius:14px;
      --shadow:0 10px 30px rgba(0,0,0,0.35);
      --space:clamp(14px, 2vw, 28px);
      --space-lg:clamp(24px, 4vw, 48px);
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,"Noto Sans",sans-serif;line-height:1.55}
    img{max-width:100%;height:auto;display:block;border-radius:12px}
    a{color:inherit;text-decoration:none}
    .wrap{max-width:var(--maxw);margin:0 auto;padding:0 var(--space)}
    header.site{
      position:relative;overflow:hidden;background:linear-gradient(180deg,#0b1633, #091028);
      border-bottom:1px solid rgba(255,255,255,0.08)
    }
    .hero{
      display:grid;grid-template-columns:1.1fr 0.9fr;gap:var(--space-lg);align-items:center;
      padding:var(--space-lg) 0 var(--space-lg);
    }
    .hero h1{font-size:clamp(26px, 4vw, 46px);margin:0;line-height:1.15}
    .hero p.lead{font-size:clamp(16px, 2.2vw, 20px);color:var(--muted);margin:12px 0 0}
    .badge{display:inline-flex;gap:10px;align-items:center;background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.15);padding:8px 12px;border-radius:999px;font-size:14px;margin:12px 0}
    .grid{display:grid;gap:var(--space);grid-template-columns:repeat(12,1fr)}
    .card{background:var(--card);border:1px solid rgba(255,255,255,0.08);border-radius:var(--radius);box-shadow:var(--shadow);padding:var(--space)}
    section{padding:var(--space-lg) 0}
    h2{font-size:clamp(22px, 3vw, 32px);margin:0 0 10px}
    h3{font-size:clamp(18px, 2.4vw, 24px);margin:0 0 8px}
    p{margin:0 0 10px}
    ul{margin:0;padding-left:20px}
    .muted{color:var(--muted)}
    .pill{display:inline-block;background:rgba(0,225,255,0.12);border:1px solid rgba(0,225,255,0.35);padding:6px 10px;border-radius:999px;font-size:13px}
    .kpi{display:grid;grid-template-columns:repeat(4,1fr);gap:var(--space)}
    .kpi .metric{background:var(--bg-soft);border:1px solid rgba(255,255,255,0.1);border-radius:12px;padding:16px;text-align:center}
    .kpi .metric .val{font-size:clamp(18px,3vw,28px);font-weight:700}
    .kpi .metric .lab{font-size:13px;color:var(--muted)}
    table{width:100%;border-collapse:separate;border-spacing:0;border:1px solid rgba(255,255,255,0.12);border-radius:12px;overflow:hidden}
    th,td{padding:12px 14px;border-bottom:1px solid rgba(255,255,255,0.08)}
    th{background:rgba(255,255,255,0.06);text-align:left}
    tr:last-child td{border-bottom:none}
    .pos{color:var(--good)} .neg{color:var(--bad)}
    .two-col{display:grid;gap:var(--space);grid-template-columns:1fr 1fr}
    .note{font-size:13px;color:var(--muted)}
    footer.site{padding:var(--space-lg) 0;border-top:1px solid rgba(255,255,255,0.08);background:#0a132b}
    /* Responsive */
    @media (max-width: 920px){
      .hero{grid-template-columns:1fr;gap:var(--space)}
      .kpi{grid-template-columns:1fr 1fr}
      .two-col{grid-template-columns:1fr}
    }
    @media (max-width: 520px){
      .kpi{grid-template-columns:1fr}
      th,td{padding:10px 12px}
    }
  </style>
</head>
<body>
  <!-- HEADER / HERO -->
  <header class="site">
    <div class="wrap hero">
      <div>
        <div class="badge">
          <span class="pill">XRPL • Low Fees • High Speed</span>
          <span class="pill">Faith-Based • Transparent Giving</span>
        </div>
        <h1>Jesus Christ Token (JCS) — Faith and Finance on the XRP Ledger</h1>
        <p class="lead">Stewardship, generosity, and global outreach powered by an energy‑efficient blockchain. 100% auditable giving, instantly settled, globally accessible.</p>
        <div class="kpi" aria-label="Project highlights">
          <div class="metric"><div class="val">XRPL</div><div class="lab">Network</div></div>
          <div class="metric"><div class="val">Low</div><div class="lab">Fees</div></div>
          <div class="metric"><div class="val">~3–5s</div><div class="lab">Settlement</div></div>
          <div class="metric"><div class="val">Eco</div><div class="lab">Footprint</div></div>
        </div>
      </div>
      <div>
        <img src="assets/img/hero-placeholder.jpg" alt="Faith-inspired XRP Ledger themed illustration" loading="lazy" />
      </div>
    </div>
  </header>

  <!-- ABOUT / MISSION -->
  <section id="mission">
    <div class="wrap grid">
      <div class="card" style="grid-column: span 7;">
        <h2>Mission</h2>
        <p>Inspired by the teachings of Jesus Christ, JCS equips believers, ministries, and donors to engage digital finance with integrity and purpose. Our focus: transparent giving, auditable impact, and global reach through the XRP Ledger.</p>
        <ul>
          <li><strong>Transparent Giving:</strong> On-ledger receipts and auditable flows.</li>
          <li><strong>Inclusive Access:</strong> Borderless support for missions, relief, and outreach.</li>
          <li><strong>Responsible Stewardship:</strong> Low fees ensure more reaches those in need.</li>
        </ul>
      </div>
      <div class="card" style="grid-column: span 5;">
        <h3>What is JCS?</h3>
        <p class="muted">A community token designed to encourage generosity, track project milestones, and reward participation in prayer, service, and outreach.</p>
        <ul>
          <li><span class="pill">XRPL Native Token</span></li>
          <li><span class="pill">Community Rewards</span></li>
          <li><span class="pill">Impact Tracking</span></li>
        </ul>
      </div>
    </div>
  </section>

  <!-- TOKEN DETAILS -->
  <section id="token">
    <div class="wrap two-col">
      <div class="card">
        <h2>Token details</h2>
        <ul>
          <li><strong>Token name:</strong> Jesus Christ Token</li>
          <li><strong>Ticker:</strong> JCS</li>
          <li><strong>Network:</strong> XRPL (mainnet)</li>
          <li><strong>Issuer account:</strong> <span id="issuer-address">[to be displayed]</span></li>
          <li><strong>Supply:</strong> <span id="supply-total">[to be displayed]</span></li>
        </ul>
        <p class="note">Note: exact issuer and supply values can be updated live from the XRPL when you enable scripts below.</p>
      </div>
      <div class="card">
        <h3>Tokenomics</h3>
        <ul>
          <li><strong>Distribution:</strong> Community, outreach funds, development, reserves.</li>
          <li><strong>Utility:</strong> Recognition, participation rewards, project milestone tracking.</li>
          <li><strong>Governance (future):</strong> Community signaling for impact priorities.</li>
        </ul>
      </div>
    </div>
  </section>

<!-- LIVE METRICS SECTION: XRP, JCS, SOLO -->
<!-- ====================== HTML, CSS, & JS ====================== -->

<!-- Import Google Fonts for visual consistency -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">

<!-- Responsive container for table -->
<div class="table-responsive">
  <table id="crypto-metrics-table" class="crypto-table">
    <thead>
      <tr>
        <th>#</th>
        <th>Name</th>
        <th>Symbol</th>
        <th>Price (USD)</th>
        <th>24h Change</th>
        <th>Market Cap</th>
        <th>Volume (24H)</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td colspan="7" style="text-align:center" id="table-loading-row">Loading live data...</td>
      </tr>
    </tbody>
  </table>
</div>

<!-- Inline CSS for table styling and responsiveness -->
<style>
  body { font-family: 'Poppins', sans-serif; color: #222; }
  .crypto-table          { width: 100%; border-collapse: collapse; background: #fff; font-size: 1rem; }
  .crypto-table th, 
  .crypto-table td       { padding: 0.8em 1em; border: 1px solid #e4e4e4; text-align: center; vertical-align: middle; }
  .crypto-table th       { background: #825CFF; color: #fff; font-weight: 600; }
  .crypto-table tbody tr:nth-child(even) { background: #f9f9fc; }
  .crypto-table tbody tr:hover           { background: #f3eaff; }
  .crypto-table .text-green              { color: #1db954; font-weight: 500; }
  .crypto-table .text-red                { color: #e74c3c; font-weight: 500; }
  .table-responsive     { width: 100%; overflow-x: auto; }

  /* Responsive font sizing for smaller devices */
  @media (max-width: 600px) {
    .crypto-table th, .crypto-table td { padding: 0.5em 0.6em; font-size: 0.92rem; }
  }
</style>

<!-- Optionally add Fetch Polyfill for older browsers -->
<!-- <script src="https://cdn.jsdelivr.net/npm/whatwg-fetch@3.6.2/dist/fetch.umd.js"></script> -->

<script>
/**
 * LIVE METRICS JAVASCRIPT
 * --------------------------------------------------
 * - Fetches real-time data for XRP, JCS, and Sologenic (SOLO)
 * - Displays price, 24h change, market cap, and 24h volume
 * - Updates table dynamically every 60 seconds
 * - No dependencies (uses fetch API - polyfill above for legacy)
 *
 * INTEGRATION INSTRUCTIONS:
 * - Embed inside any HTML file where live metrics are needed
 * - Place at the end of the <body> section, after the table markup
 * - Ensure CSS and font imports (edit or comment if using own scheme)
 * --------------------------------------------------
 */

document.addEventListener('DOMContentLoaded', function () {
  // CoinGecko API endpoint & IDs for XRP, JCS, SOLO
  const API_URL = 'https://api.coingecko.com/api/v3/simple/price?ids=ripple,jesus-coin,sologenic&vs_currencies=usd&include_market_cap=true&include_24hr_vol=true&include_24hr_change=true';

  // Index labels and table rows (for Name/Symbol mapping)
  const COINS = [
    { id: 'ripple',       name: 'XRP', symbol: 'XRP' },
    { id: 'jesus-coin',   name: 'JCS', symbol: 'JCS' },
    { id: 'sologenic',    name: 'SOLO', symbol: 'SOLO' }
  ];
  
  const tableBody = document.querySelector('#crypto-metrics-table tbody');
  const loadingRowId = 'table-loading-row';

  // Utility for large numbers with thousand separators and symbols
  function formatValue(value, symbol = '$', digits = 2) {
    if (!value && value !== 0) return '—';
    if (Math.abs(value) >= 1e9)
      return symbol + (value / 1e9).toFixed(digits) + 'B';
    if (Math.abs(value) >= 1e6)
      return symbol + (value / 1e6).toFixed(digits) + 'M';
    if (Math.abs(value) >= 1e3)
      return symbol + (value / 1e3).toFixed(digits) + 'K';
    return symbol + Number(value).toLocaleString(undefined, {minimumFractionDigits: digits, maximumFractionDigits: digits});
  }
  // Utility for % formatting
  function formatChange(val, digits = 2) {
    const num = Number(val);
    if (isNaN(num)) return '—';
    const cls = num >= 0 ? 'text-green' : 'text-red';
    const sign = num > 0 ? '+' : '';
    return `<span class="${cls}">${sign}${num.toFixed(digits)}%</span>`;
  }

  /**
   * Fetches live data for the defined assets and renders the table.
   * Retry logic built-in: up to 3 total attempts, 2s between retries.
   */
  async function fetchAndRenderLiveMetrics(retries = 3) {
    try {
      // Fetch data from CoinGecko API
      const response = await fetch(API_URL);
      if (!response.ok) throw new Error(`API Error: HTTP ${response.status}`);
      const data = await response.json();
      // Remove loading row if present
      const loadingRow = document.getElementById(loadingRowId);
      if (loadingRow) loadingRow.remove();
      // Build table rows
      let rowsHtml = '';
      COINS.forEach((coin, idx) => {
        const d = data[coin.id] || {};
        rowsHtml += `
          <tr>
            <td>${idx + 1}</td>
            <td>${coin.name}</td>
            <td>${coin.symbol}</td>
            <td>${formatValue(d.usd)}</td>
            <td>${formatChange(d.usd_24h_change)}</td>
            <td>${formatValue(d.usd_market_cap)}</td>
            <td>${formatValue(d.usd_24h_vol)}</td>
          </tr>
        `;
      });
      tableBody.innerHTML = rowsHtml;
    } catch (err) {
      // If this was the last retry, display error
      if (retries === 1) {
        tableBody.innerHTML = `<tr><td colspan="7" style="color:#e53935;text-align:center;">Error fetching live data. Please try refreshing.</td></tr>`;
        console.error("Live metrics error:", err);
      } else {
        // Wait and retry
        setTimeout(() => fetchAndRenderLiveMetrics(retries - 1), 2000);
      }
    }
  }

  // Initial load and interval refresh setup
  fetchAndRenderLiveMetrics();
  setInterval(fetchAndRenderLiveMetrics, 60000); // Update every 60 sec
});
</script>

<!-- ===================== END LIVE METRICS ===================== -->


  <!-- HOW IT WORKS -->
  <section id="how">
    <div class="wrap two-col">
      <div class="card">
        <h2>How it works</h2>
        <ol>
          <li>Choose a wallet that supports XRPL.</li>
          <li>Set a trustline to JCS.</li>
          <li>Send and receive with low fees and instant settlement.</li>
        </ol>
        <p class="note">Trustline, issuer, and domain verification can be automated later; placeholders are used here.</p>
      </div>
      <div class="card">
        <h3>Faith and impact</h3>
        <p>Every transaction can reflect generosity and care, with transparent records that uphold accountability.</p>
        <img src="assets/img/impact-placeholder.jpg" alt="Illustration of transparent giving and impact tracking" loading="lazy" />
      </div>
    </div>
  </section>

  <!-- ROADMAP -->
  <section id="roadmap">
    <div class="wrap">
      <h2>Roadmap</h2>
      <div class="grid">
        <div class="card" style="grid-column: span 4;">
          <h3>Phase 1</h3>
          <p>Token setup, mission articulation, website foundation, basic metrics.</p>
        </div>
        <div class="card" style="grid-column: span 4;">
          <h3>Phase 2</h3>
          <p>Community rewards, education content, automated impact reporting.</p>
        </div>
        <div class="card" style="grid-column: span 4;">
          <h3>Phase 3</h3>
          <p>Governance signals, partnerships, broader integrations.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- FAQ -->
  <section id="faq">
    <div class="wrap">
      <h2>FAQ</h2>
      <div class="two-col">
        <div class="card">
          <h3>What is JCS?</h3>
          <p>A faith-driven community token on XRPL to support transparent giving and engagement.</p>
        </div>
        <div class="card">
          <h3>Is this investment advice?</h3>
          <p>No. JCS is for education, community, and outreach support. Do your own research.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- COMPLIANCE / DISCLOSURE -->
  <section id="compliance">
    <div class="wrap">
      <div class="card">
        <h2>Disclosures</h2>
        <p>All content is informational and reflects a faith-based initiative on the XRP Ledger. No guarantees are made regarding price or performance. Use responsibly.</p>
      </div>
    </div>
  </section>

  <!-- FOOTER -->
  <footer class="site">
    <div class="wrap">
      <div class="two-col">
        <div class="card">
          <h3>Project identity</h3>
          <ul>
            <li><strong>Project:</strong> Jesus Christ Token (JCS)</li>
            <li><strong>Network:</strong> XRPL (mainnet)</li>
            <li><strong>Domain:</strong> [to be finalized]</li>
          </ul>
          <p class="note">Add DID and xrp-ledger.toml once your new domain is ready.</p>
        </div>
        <div class="card">
          <h3>Contact</h3>
          <p class="muted">Add your preferred contact channel later. No links are included yet.</p>
        </div>
      </div>
      <p class="note" style="margin-top:14px;">© 2025 Jesus Christ Saves Ministry — Powered by the XRP Ledger.</p>
    </div>
  </footer>
<script>
/**
 * JCS live metrics engine (resilient)
 * - XRP: CoinGecko primary, Kraken fallback
 * - SOLO: CoinGecko (graceful if blocked)
 * - JCS: XRPL DEX top-of-book midpoint (XRP per JCS), then * XRP/USD
 */

const CONFIG = {
  ISSUER: 'rPU6sXCNzsjcTUEmgJQ5SxDUzY2y1RyYKd',
  CURRENCY: 'JCS',
  SUPPLY: 1_000_000_000_000,
  XRPL_WSS: 'wss://xrplcluster.com',
  REFRESH_MS: 30_000,
  PRICE_DECIMALS: { xrp: 4, solo: 4, jcs: 8 }
};

// ---- DOM helpers ----
const $ = (id) => document.getElementById(id);
const setText = (id, val) => { const el = $(id); if (el) el.textContent = val; };
const setChange = (id, pct) => {
  const el = $(id);
  if (!el) return;
  if (pct == null || Number.isNaN(pct)) { el.textContent = '—'; el.removeAttribute('data-dir'); return; }
  const dir = pct >= 0 ? 'up' : 'down';
  el.textContent = `${pct.toFixed(2)}%`;
  el.setAttribute('data-dir', dir);
};

// ---- Formatters ----
const fmtUSD = (n, dp = 2) => (Number.isFinite(n) ? (n < 1 ? `$${n.toFixed(dp)}` : `$${n.toLocaleString(undefined, { maximumFractionDigits: dp })}`) : '—');
const safeMid = (bid, ask) => (Number.isFinite(bid) && Number.isFinite(ask)) ? (bid + ask) / 2 : (Number.isFinite(bid) ? bid : (Number.isFinite(ask) ? ask : null));

// ---- CoinGecko primary ----
async function fetchCgSimple(ids) {
  const url = `https://api.coingecko.com/api/v3/simple/price?ids=${encodeURIComponent(ids.join(','))}&vs_currencies=usd&include_24hr_change=true`;
  const res = await fetch(url, { headers: { 'accept': 'application/json' }, cache: 'no-store' });
  if (!res.ok) throw new Error(`CoinGecko HTTP ${res.status}`);
  return res.json();
}

// ---- XRP/USD fallback (Kraken) ----
async function fetchKrakenXrpUsd() {
  const res = await fetch('https://api.kraken.com/0/public/Ticker?pair=XXRPZUSD', { cache: 'no-store' });
  if (!res.ok) throw new Error(`Kraken HTTP ${res.status}`);
  const d = await res.json();
  const t = d?.result?.XXRPZUSD;
  const last = t?.c ? Number(t.c[0]) : null; // last trade price
  const open = t?.o ? Number(t.o) : null;    // today's open (approx 24h anchor)
  const chg = (Number.isFinite(last) && Number.isFinite(open) && open > 0) ? ((last - open) / open) * 100 : null;
  return { usd: last ?? null, chg: chg ?? null };
}

// ---- Benchmarks (XRP + SOLO) with fallback for XRP ----
async function getFiatBenchmarks() {
  try {
    const data = await fetchCgSimple(['ripple', 'sologenic']);
    const xrpUsd = data?.ripple?.usd ?? null;
    const xrpChg = data?.ripple?.usd_24h_change ?? null;
    const soloUsd = data?.sologenic?.usd ?? null;
    const soloChg = data?.sologenic?.usd_24h_change ?? null;
    return {
      xrp: { usd: xrpUsd, chg: xrpChg },
      solo: { usd: soloUsd, chg: soloChg }
    };
  } catch (e) {
    console.warn('CoinGecko failed, using Kraken for XRP only:', e.message);
    const xrp = await fetchKrakenXrpUsd().catch(err => { console.warn('Kraken fallback failed:', err.message); return { usd: null, chg: null }; });
    // SOLO has no robust public fallback without keys; leave nulls if CG blocked
    return { xrp, solo: { usd: null, chg: null } };
  }
}

// ---- Lightweight XRPL WS client ----
function xrplWs(url) {
  const ws = new WebSocket(url);
  const pending = new Map();
  let nextId = 1;

  ws.onmessage = (ev) => {
    try {
      const msg = JSON.parse(ev.data);
      const id = msg.id;
      if (id && pending.has(id)) {
        const { resolve, reject, timer } = pending.get(id);
        clearTimeout(timer);
        pending.delete(id);
        if (msg.status === 'success') resolve(msg);
        else reject(new Error(msg.error_message || msg.error || 'XRPL error'));
      }
    } catch (_) {}
  };

  function send(command, params, timeoutMs = 6000) {
    return new Promise((resolve, reject) => {
      const doSend = () => {
        const id = nextId++;
        const payload = { id, command, ...params };
        const timer = setTimeout(() => {
          if (pending.has(id)) { pending.delete(id); reject(new Error('XRPL request timeout')); }
        }, timeoutMs);
        pending.set(id, { resolve, reject, timer });
        ws.send(JSON.stringify(payload));
      };
      if (ws.readyState === 1) return doSend();
      if (ws.readyState === 0) {
        ws.addEventListener('open', doSend, { once: true });
        return;
      }
      reject(new Error('WebSocket not open'));
    });
  }

  function close() { try { ws.close(); } catch (_) {} }
  return { send, close };
}

// ---- Correct JCS/XRP top-of-book (normalize drops) ----
const DROPS_PER_XRP = 1_000_000;

async function getJcsXrpTopOfBook() {
  const { ISSUER, CURRENCY, XRPL_WSS } = CONFIG;
  const client = xrplWs(XRPL_WSS);

  try {
    // Asks: offers to SELL JCS for XRP (taker pays XRP, gets JCS)
    const asksP = client.send('book_offers', {
      taker_pays: { currency: 'XRP' },
      taker_gets: { currency: CURRENCY, issuer: ISSUER },
      limit: 20
    });
    // Bids: offers to BUY JCS with XRP (taker pays JCS, gets XRP)
    const bidsP = client.send('book_offers', {
      taker_pays: { currency: CURRENCY, issuer: ISSUER },
      taker_gets: { currency: 'XRP' },
      limit: 20
    });

    const [asksRes, bidsRes] = await Promise.all([asksP, bidsP]);
    const asks = Array.isArray(asksRes.result?.offers) ? asksRes.result.offers : [];
    const bids = Array.isArray(bidsRes.result?.offers) ? bidsRes.result.offers : [];

    // quality = TakerPays / TakerGets
    // Asks: quality = drops (XRP) / JCS -> XRP per JCS = quality / 1e6
    const askPrices = asks
      .map(o => Number(o.quality))
      .filter(Number.isFinite)
      .map(q => q / DROPS_PER_XRP);

    // Bids: quality = JCS / drops (XRP) -> XRP per JCS = 1 / (quality * 1e6)
    const bidPrices = bids
      .map(o => Number(o.quality))
      .filter(Number.isFinite)
      .map(q => 1 / (q * DROPS_PER_XRP));

    const bestAsk = askPrices.length ? Math.min(...askPrices) : null;
    const bestBid = bidPrices.length ? Math.max(...bidPrices) : null;

    return { bestBid, bestAsk, mid: safeMid(bestBid, bestAsk) };
  } finally {
    client.close();
  }
}

// ---- Main loop ----
let lastJcsUsd = null;

async function refreshMetrics() {
  try {
    const [{ xrp, solo }, jcsBook] = await Promise.all([
      getFiatBenchmarks(),
      getJcsXrpTopOfBook().catch(err => { console.warn('XRPL book error:', err.message); return { bestBid: null, bestAsk: null, mid: null }; })
    ]);

    // XRP + SOLO
    setText('xrpPrice', fmtUSD(xrp.usd, CONFIG.PRICE_DECIMALS.xrp));
    setChange('xrpChange', xrp.chg);
    setText('soloPrice', fmtUSD(solo.usd, CONFIG.PRICE_DECIMALS.solo));
    setChange('soloChange', solo.chg);

    // JCS: mid (XRP per JCS) * XRP/USD
    const jcsXrp = jcsBook.mid;
    const jcsUsd = (Number.isFinite(jcsXrp) && Number.isFinite(xrp.usd)) ? jcsXrp * xrp.usd : null;

    const jcsChange = (Number.isFinite(lastJcsUsd) && Number.isFinite(jcsUsd))
      ? ((jcsUsd - lastJcsUsd) / lastJcsUsd) * 100
      : null;

    if (Number.isFinite(jcsUsd)) lastJcsUsd = jcsUsd;

    setText('jcsPrice', Number.isFinite(jcsUsd) ? fmtUSD(jcsUsd, CONFIG.PRICE_DECIMALS.jcs) : '—');
    setChange('jcsChange', Number.isFinite(jcsChange) ? jcsChange : null);

    const mcap = Number.isFinite(jcsUsd) ? jcsUsd * CONFIG.SUPPLY : null;
    setText('jcsMcap', Number.isFinite(mcap) ? fmtUSD(mcap, 0) : '—');

  } catch (e) {
    console.warn('Metrics refresh failed:', e);
    // Do not overwrite existing content on failure
  }
}

function startMetrics() {
  refreshMetrics();
  setInterval(refreshMetrics, CONFIG.REFRESH_MS);
}

if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', startMetrics);
} else {
  startMetrics();
}
</script>


</body>

</html>

