<!DOCTYPE html>
<html lang="en">
<head>
<!-- 
  ===================================
  META SECTION — JCS + XAMAN + AI-READY
  ===================================
-->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<title>Xaman Wallet Connect · Jesus Christ Saves Token (JCS)</title>

<!-- Canonical & Language -->
<link rel="canonical" href="https://jesuschristsavestoken.com/connectwallet.html" />
<link rel="alternate" hreflang="en" href="https://jesuschristsavestoken.com/connectwallet.html" />

<!-- Primary SEO -->
<meta name="description" content="Connect your Xaman (formerly Xumm) wallet to interact with Jesus Christ Saves Token (JCS) on the XRP Ledger. Non-custodial, open, AI-readable manifest, and verifiable on-ledger." />
<meta name="keywords" content="Jesus Christ Saves Token, JCS, Xaman, Xumm, XRPL, XRP Ledger, Christian crypto, faith token, connect wallet, non-custodial, AI manifest" />
<meta name="robots" content="index,follow,max-snippet:-1,max-image-preview:large,max-video-preview:-1" />
<meta name="theme-color" content="#111111" />

<!-- Open Graph -->
<meta property="og:locale" content="en_US" />
<meta property="og:type" content="website" />
<meta property="og:site_name" content="Jesus Christ Saves Token" />
<meta property="og:title" content="Xaman Wallet Connect · Jesus Christ Saves Token (JCS)" />
<meta property="og:description" content="Non-custodial XRPL connect for JCS. Transparent, AI-discoverable, and verifiable on-ledger." />
<meta property="og:url" content="https://jesuschristsavestoken.com/connectwallet.html" />
<meta property="og:image" content="https://jesuschristsavestoken.com/shroud-bg.jpg" />
<meta property="og:image:alt" content="Shroud-themed backdrop for JCS Wallet Connect" />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />

<!-- Twitter -->
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:site" content="@JesusCS_token" />
<meta name="twitter:title" content="Xaman Wallet Connect · Jesus Christ Saves Token (JCS)" />
<meta name="twitter:description" content="Connect via Xaman to interact with JCS on XRPL — non-custodial and AI-readable." />
<meta name="twitter:image" content="https://jesuschristsavestoken.com/shroud-bg.jpg" />

<!-- AI & XRPL Discoverability -->
<link rel="alternate" type="application/json" href="/ai.json" title="AI Manifest" />
<link rel="asset" href="/.well-known/xrpl.toml" type="text/plain" />

<!-- Favicons & App Icons -->
<link rel="icon" href="https://jesuschristsavestoken.com/jcs-logo.png" type="image/png" />
<link rel="icon" type="image/png" sizes="32x32" href="https://jesuschristsavestoken.com/jcs-logo-32.png" />
<link rel="icon" type="image/png" sizes="192x192" href="https://jesuschristsavestoken.com/jcs-logo-192.png" />
<link rel="apple-touch-icon" sizes="180x180" href="https://jesuschristsavestoken.com/jcs-logo-180.png" />
<meta name="msapplication-TileImage" content="https://jesuschristsavestoken.com/jcs-logo-270.png" />
<meta name="msapplication-TileColor" content="#111111" />

<!-- Performance: DNS Prefetch / Preconnect -->
<link rel="dns-prefetch" href="https://fonts.googleapis.com" />
<link rel="dns-prefetch" href="https://fonts.gstatic.com" />
<link rel="preconnect" href="https://fonts.googleapis.com" crossorigin />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link rel="dns-prefetch" href="https://xaman.app" />
<link rel="preconnect" href="https://xaman.app" crossorigin />
<link rel="dns-prefetch" href="https://api.coingecko.com" />
<link rel="dns-prefetch" href="wss://xrplcluster.com" />

<!-- Structured Data (JSON-LD) -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": "Jesus Christ Saves Token",
  "url": "https://jesuschristsavestoken.com/",
  "logo": "https://jesuschristsavestoken.com/jcs-logo.png",
  "sameAs": ["https://x.com/JesusCS_token"],
  "additionalProperty": [
    { "@type": "PropertyValue", "name": "XRPL Issuer", "value": "rPU6sXCNzsjcTUEmgJQ5SxDUzY2y1RyYKd" },
    { "@type": "PropertyValue", "name": "Currency Code", "value": "JCS" },
    { "@type": "PropertyValue", "name": "AI Manifest", "value": "https://jesuschristsavestoken.com/ai.json" },
    { "@type": "PropertyValue", "name": "XRPL TOML", "value": "https://jesuschristsavestoken.com/.well-known/xrpl.toml" }
  ]
}
</script>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebSite",
  "url": "https://jesuschristsavestoken.com/",
  "name": "Jesus Christ Saves Token (JCS)",
  "description": "Faith-based cryptocurrency on the XRPL for believers worldwide.",
  "publisher": {
    "@type": "Organization",
    "name": "Jesus Christ Saves Token",
    "logo": { "@type": "ImageObject", "url": "https://jesuschristsavestoken.com/jcs-logo.png" }
  },
  "potentialAction": {
    "@type": "Action",
    "name": "Connect via Xaman",
    "target": "https://jesuschristsavestoken.com/connectwallet.html"
  }
}
</script>

<!-- Optional: describe this specific page as a WebApplication -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "SoftwareApplication",
  "name": "JCS · Wallet Connect (Xaman)",
  "operatingSystem": "Web",
  "applicationCategory": "FinanceApplication",
  "offers": { "@type": "Offer", "price": "0", "priceCurrency": "USD" },
  "softwareVersion": "1.0",
  "url": "https://jesuschristsavestoken.com/connectwallet.html",
  "about": {
    "@type": "Thing",
    "name": "Jesus Christ Saves Token (JCS)",
    "sameAs": "https://jesuschristsavestoken.com/"
  }
}
</script>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=UnifrakturCook:wght@700&family=Montserrat:wght@400;700&display=swap" rel="stylesheet" />

<style>
/* ============================================================
   Xaman (Xumm) QR Modal — (FYI: iframe-insulated; harmless to keep)
   ============================================================ */
.xumm-about,
[data-testid="xumm-about"],
.xumm-modal-header a[href*="about"],
.xumm-modal-header button[aria-label="About"],
.xumm-qr-modal a[href*="/about"],
.xumm-qr a[href*="/about"] { display: none !important; }

.xumm-modal-header a.xumm-title,
.xumm-modal-header a.xumm-title-link,
.xumm-modal-header h1 a,
.xumm-modal-header h2 a,
.xumm-modal-header .xumm-title a,
.xumm-modal-header .title a,
.xumm-qr .xumm-title a,
.xumm-qr .title a,
.xumm-modal-header > a:first-child,
.xumm-modal-header .brand a,
.xumm-modal-header .logo a {
  pointer-events: none !important;
  cursor: default !important;
  text-decoration: none !important;
  color: inherit !important;
}
</style>

<!-- Xumm/Xaman SDK -->
<script>
/**
 * JCS · Xaman Connect (Custom Modal)
 * Desktop: QR + deep link
 * Mobile: direct deep link (no QR)
 * No embedded iframe header; avoids 404.local
 */

//////////////////////////////
// 0) SDK init (unchanged) //
//////////////////////////////
const xumm = new Xumm('7737775c-1645-4a4e-a92d-ffe51530a348');

//////////////////////////////
// 1) Grab existing elements //
//////////////////////////////
const connectWalletButton  = document.getElementById('connectWalletButton');
const logoutButton         = document.getElementById('logoutButton');
const walletAddressElement = document.getElementById('walletAddress');
const statusDiv            = document.getElementById('status');
const ledgerCounter        = document.getElementById('ledgerCounter');
const trustlineButton      = document.getElementById('trustlineButton'); // if you wire later
const buyButton            = document.getElementById('buyButton');       // if you wire later

// Lightweight ledger ticker (kept)
let ledger = 987654;
setInterval(() => {
  ledger += Math.floor(Math.random() * 3);
  if (ledgerCounter) ledgerCounter.textContent = "Ledger Count: " + ledger.toLocaleString();
}, 4000);

/////////////////////////////////////
// 2) Build a branded custom modal //
/////////////////////////////////////
const modal = document.createElement('div');
modal.id = 'xamanModal';
Object.assign(modal.style, {
  display:'none', position:'fixed', inset:'0', background:'rgba(0,0,0,.72)',
  zIndex:'2147483646', alignItems:'center', justifyContent:'center'
});

const panel = document.createElement('div');
Object.assign(panel.style, {
  width:'min(520px,92vw)', background:'#0f1115', color:'#fff',
  borderRadius:'14px', padding:'22px', boxShadow:'0 10px 40px rgba(0,0,0,.6)',
  border:'1px solid rgba(255,255,255,.06)', fontFamily:'Montserrat,system-ui'
});

// Header
const headerRow = document.createElement('div');
Object.assign(headerRow.style, { display:'flex', alignItems:'center', justifyContent:'space-between', gap:'12px', marginBottom:'14px' });

const brand = document.createElement('div');
Object.assign(brand.style, { display:'flex', alignItems:'center', gap:'10px' });

const logo = document.createElement('img');
logo.src = 'https://xaman.app/favicon.ico';
logo.alt = 'Xaman';
logo.width = 20; logo.height = 20;
logo.style.borderRadius = '4px';

const brandText = document.createElement('div');
brandText.style.lineHeight = '1.1';
const brandStrong = document.createElement('strong');
brandStrong.textContent = 'Connect with Xaman';
Object.assign(brandStrong.style, { fontWeight:'700', fontSize:'16px' });
const brandSub = document.createElement('span');
brandSub.textContent = 'Powered by Xaman (formerly Xumm)';
Object.assign(brandSub.style, { fontWeight:'500', fontSize:'12px', color:'#9bb3d1', display:'block', marginTop:'2px' });
brandText.appendChild(brandStrong);
brandText.appendChild(brandSub);

brand.appendChild(logo);
brand.appendChild(brandText);

const closeBtn = document.createElement('button');
closeBtn.id = 'xamanClose';
closeBtn.setAttribute('aria-label','Close');
closeBtn.textContent = '✕';
Object.assign(closeBtn.style, { background:'#1b1f2a', color:'#cbd5e1', border:'0', borderRadius:'8px', padding:'6px 10px', cursor:'pointer' });

headerRow.appendChild(brand);
headerRow.appendChild(closeBtn);

// Body
const body = document.createElement('div');
body.id = 'xamanModalBody';
Object.assign(body.style, { display:'grid', gap:'16px', justifyItems:'center', textAlign:'center' });

const qrImg = document.createElement('img');
qrImg.id = 'xamanQR';
qrImg.alt = 'Scan this QR with the Xaman app';
Object.assign(qrImg.style, {
  width:'280px', height:'280px', objectFit:'contain',
  background:'#fff', borderRadius:'10px', padding:'8px', display:'none'
});

const deeplinkA = document.createElement('a');
deeplinkA.id = 'xamanDeeplink';
deeplinkA.target = '_blank';
deeplinkA.rel = 'noopener';
deeplinkA.textContent = 'Open in Xaman';
Object.assign(deeplinkA.style, {
  display:'none', background:'#3b82f6', color:'#fff',
  textDecoration:'none', padding:'10px 16px', borderRadius:'10px', fontWeight:'700'
});

const modalStatus = document.createElement('div');
modalStatus.id = 'xamanStatus';
Object.assign(modalStatus.style, { color:'#b8c7e0', fontSize:'14px' });
modalStatus.textContent = 'Preparing secure connection…';

const micro = document.createElement('div');
micro.textContent = 'You’ll review and approve in the Xaman app. We never see your secret keys.';
Object.assign(micro.style, { color:'#93a4bd', fontSize:'11px' });

body.appendChild(qrImg);
body.appendChild(deeplinkA);
body.appendChild(modalStatus);
body.appendChild(micro);

panel.appendChild(headerRow);
panel.appendChild(body);
modal.appendChild(panel);
document.body.appendChild(modal);

// Helpers
function openModal(){ modal.style.display = 'flex'; }
function closeModal(){ modal.style.display = 'none'; }
closeBtn.addEventListener('click', closeModal);

//////////////////////////////////////
// 3) Mobile detection (no QR on mobile)
//////////////////////////////////////
function isMobile() {
  const ua = navigator.userAgent || '';
  const mobileUA = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Windows Phone/i.test(ua);
  const smallScreen = matchMedia && matchMedia('(max-width: 812px)').matches; // phones & many small tablets
  return mobileUA || smallScreen;
}

//////////////////////////////////////
// 4) SDK lifecycle + connect flow //
//////////////////////////////////////
xumm.on('ready', () => {
  if (statusDiv) statusDiv.textContent = 'Xumm SDK loaded and ready.';
  if (connectWalletButton) connectWalletButton.disabled = false;
});

// SIGN IN payload JSON (this is the only JSON required for connect)
const SIGNIN_PAYLOAD = { txjson: { TransactionType: 'SignIn' } };

// Connect handler
if (connectWalletButton) {
  connectWalletButton.onclick = async () => {
    openModal();
    qrImg.style.display = 'none';
    deeplinkA.style.display = 'none';
    modalStatus.textContent = 'Generating SignIn request…';

    try {
      const sub = await xumm.payload.createAndSubscribe(
        SIGNIN_PAYLOAD,
        evt => {
          if (evt?.data?.signed === true) modalStatus.textContent = 'Signed. Finalizing…';
          else if (evt?.data?.signed === false) modalStatus.textContent = 'Request rejected in Xaman.';
        }
      );

      const { created, resolved } = sub;

      // Build the deep link (universal link Xaman provides)
      const deep = created?.next?.always || created?.refs?.link || '';
      const qr   = created?.refs?.qr_png || '';

      // MOBILE: no QR, go straight to app
      if (isMobile() && deep) {
        modalStatus.textContent = 'Opening Xaman…';
        // try to open in-place (fewer pop-up blockers on mobile)
        window.location.href = deep;
        // keep a fallback button in case the OS blocks navigation
        deeplinkA.href = deep;
        deeplinkA.style.display = '';
      } else {
        // DESKTOP: show QR (and also the deep link button as a backup)
        if (qr) { qrImg.src = qr; qrImg.style.display = ''; }
        if (deep) { deeplinkA.href = deep; deeplinkA.style.display = ''; }
        modalStatus.textContent = 'Scan the QR with Xaman, or click the button.';
      }

      // Wait for result
      const outcome = await resolved; // { signed: boolean, ... }
      if (!outcome?.signed) {
        modalStatus.textContent = 'Not signed. You can close this window.';
        return;
      }

      // On success, fetch account & update UI
      try {
        const account = await xumm.user.account;
        walletAddressElement.textContent = 'Wallet Connected: ' + account;
        connectWalletButton.style.display = 'none';
        if (logoutButton) logoutButton.style.display = '';
        if (statusDiv) statusDiv.textContent = 'Connected successfully via SignIn.';
      } catch (e) {
        if (statusDiv) statusDiv.textContent = 'Signed, but unable to fetch account. (Try refresh.)';
      } finally {
        closeModal();
      }
    } catch (err) {
      console.error(err);
      modalStatus.textContent = 'Error creating SignIn. Please try again.';
    }
  };
}

//////////////////////////////////////
// 5) Logout (unchanged semantics)  //
//////////////////////////////////////
if (logoutButton) {
  logoutButton.onclick = () => {
    xumm.logout();
    if (statusDiv) statusDiv.textContent = 'Logging out...';
  };
}

xumm.on('logout', () => {
  walletAddressElement.textContent = 'Status: Not connected';
  if (connectWalletButton) connectWalletButton.style.display = '';
  if (logoutButton) logoutButton.style.display = 'none';
  if (statusDiv) statusDiv.textContent = 'You have logged out.';
});
</script>

</body>
</html>

